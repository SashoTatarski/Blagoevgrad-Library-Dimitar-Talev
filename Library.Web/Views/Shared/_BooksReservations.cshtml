@model BookIssuedViewModel
@{
    ViewData["Title"] = "_BooksReservations";
}

<tr>
    <td class="text-left">
        <a asp-controller="BookManagement" asp-action="AuthorDetails" asp-route-id="@Model.Author.Id" span title="All Books From @Model.Author.Name">@Model.Author.Name</a>
    </td>
    <td class="text-left">
        <a asp-controller="BookManagement" asp-action="BookDetails" asp-route-id="@Model.ISBN" span title="View Book Details"> @Model.Title</a>
    </td>

    <td class="text-left">@Model.ISBN</td>
    <td class="text-left">@Model.StartDate?.ToString("dd.MM.yyyy")</td>

    <td class="text-left">@Model.EndDate?.ToString("dd.MM.yyyy")</td>

    @if (User.IsInRole("user"))
    {
        <td class="text-center">
            @*when the book is reserved*@
            @if (Model.IsReserved)
            {
                <a class="btn btn-secondary" asp-controller="UserBooks" asp-action="CancelReservation" asp-route-id="@Model.BookId">Cancel Reservation</a>
            }
            @*when the book is only checkedout*@
            else
            {
                @if (Model.Status == "CheckedOutAndReserved")
                {
                    <a class="btn btn-secondary" asp-controller="UserBooks" asp-action="ReturnBook" asp-route-id="@Model.ISBN">Return</a>
                    <a class="btn btn-info disabled" role="button" aria-disabled="true">Rate</a>
                    <select asp-for="@Model.Rating" asp-items="@Model.Rating" class="form-control"></select>

                }
                else if (Model.Status == "CheckedOut")
                {
                    <a class="btn btn-secondary" asp-controller="UserBooks" asp-action="ReturnBook" asp-route-id="@Model.ISBN">Return</a>
                    <a class="btn btn-info" asp-controller="UserBooks" asp-action="ExtendDueDate" asp-route-id="@Model.BookId">Extend</a>
                    <br />

                    <form asp-action="RateBook" asp-controller="UserBooks" asp-route-id="@Model.Rating.ToString()"method="post">                        
                        <select asp-for="@Model.Rating" asp-items="@Model.Rating" asp-route-id="@Model.BookId" class="form-control"></select>
                        <button type="submit" class="btn btn-info">Rate</button>
                    </form>
                }
            }

        </td>
    }
</tr>
